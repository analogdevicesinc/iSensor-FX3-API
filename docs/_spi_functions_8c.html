<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ADI iSensor FX3 Firmware: C:/Users/anolan3/Documents/iSensor-FX3-Firmware/SpiFunctions.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Analog-Devices-Logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ADI iSensor FX3 Firmware
   &#160;<span id="projectnumber">v2.0.3-pub</span>
   </div>
   <div id="projectbrief">Firmware for the Analog Devices iSensor FX3 Evaluation Platform. This firmware is built upon libraries provided by Cypress, and can be compiled using the Cypress EZ USB Suite</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">C:/Users/anolan3/Documents/iSensor-FX3-Firmware/SpiFunctions.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file contains all generic SPI read/write function implementations.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="_spi_functions_8h_source.html">SpiFunctions.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5254848805c4b8e74cbc8e94fa78307f"><td class="memItemLeft" align="right" valign="top">CyU3PReturnStatus_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_spi_functions_8c.html#a5254848805c4b8e74cbc8e94fa78307f">AdiTransferBytes</a> (uint32_t writeData)</td></tr>
<tr class="memdesc:a5254848805c4b8e74cbc8e94fa78307f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function performs a protocol agnostic SPI bi-directional SPI transfer of (1, 2, 4) bytes.  <a href="#a5254848805c4b8e74cbc8e94fa78307f">More...</a><br /></td></tr>
<tr class="separator:a5254848805c4b8e74cbc8e94fa78307f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57c7fc11222c453959c72eec1aa8afa2"><td class="memItemLeft" align="right" valign="top">CyU3PReturnStatus_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_spi_functions_8c.html#a57c7fc11222c453959c72eec1aa8afa2">AdiReadRegBytes</a> (uint16_t addr)</td></tr>
<tr class="memdesc:a57c7fc11222c453959c72eec1aa8afa2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function reads a single 16 bit SPI word from a slave device.  <a href="#a57c7fc11222c453959c72eec1aa8afa2">More...</a><br /></td></tr>
<tr class="separator:a57c7fc11222c453959c72eec1aa8afa2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09c91fa11a171844d59e40a4d0fee7cf"><td class="memItemLeft" align="right" valign="top">CyU3PReturnStatus_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_spi_functions_8c.html#a09c91fa11a171844d59e40a4d0fee7cf">AdiWriteRegByte</a> (uint16_t addr, uint8_t data)</td></tr>
<tr class="memdesc:a09c91fa11a171844d59e40a4d0fee7cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function writes a single byte of data over the SPI bus.  <a href="#a09c91fa11a171844d59e40a4d0fee7cf">More...</a><br /></td></tr>
<tr class="separator:a09c91fa11a171844d59e40a4d0fee7cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa083144a6203655613621a89d8e809e1"><td class="memItemLeft" align="right" valign="top">CyU3PReturnStatus_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_spi_functions_8c.html#aa083144a6203655613621a89d8e809e1">AdiSpiResetFifo</a> (CyBool_t isTx, CyBool_t isRx)</td></tr>
<tr class="memdesc:aa083144a6203655613621a89d8e809e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function resets the SPI FIFO and disables the SPI block after completion.  <a href="#aa083144a6203655613621a89d8e809e1">More...</a><br /></td></tr>
<tr class="separator:aa083144a6203655613621a89d8e809e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a788c3bd92096e55b7fde4da3a0308f5c"><td class="memItemLeft" align="right" valign="top">CyU3PReturnStatus_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_spi_functions_8c.html#a788c3bd92096e55b7fde4da3a0308f5c">AdiGetSpiSettings</a> ()</td></tr>
<tr class="memdesc:a788c3bd92096e55b7fde4da3a0308f5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function handles vendor commands to get the current SPI configuration from the FX3.  <a href="#a788c3bd92096e55b7fde4da3a0308f5c">More...</a><br /></td></tr>
<tr class="separator:a788c3bd92096e55b7fde4da3a0308f5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa715a94cb680f243e03c7d6d2d93503c"><td class="memItemLeft" align="right" valign="top">CyBool_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_spi_functions_8c.html#aa715a94cb680f243e03c7d6d2d93503c">AdiSpiUpdate</a> (uint16_t index, uint16_t value, uint16_t length)</td></tr>
<tr class="memdesc:aa715a94cb680f243e03c7d6d2d93503c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function handles a vendor command request to update the SPI/DR Pin configuration.  <a href="#aa715a94cb680f243e03c7d6d2d93503c">More...</a><br /></td></tr>
<tr class="separator:aa715a94cb680f243e03c7d6d2d93503c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af61156727a983c3f2ebfd9ae0e5bac71"><td class="memItemLeft" align="right" valign="top"><a id="af61156727a983c3f2ebfd9ae0e5bac71"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>USBBuffer</b> [4096]</td></tr>
<tr class="separator:af61156727a983c3f2ebfd9ae0e5bac71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadb5735a48942c795b3be33a17c14eb4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_board_state.html">BoardState</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_spi_functions_8c.html#aadb5735a48942c795b3be33a17c14eb4">FX3State</a></td></tr>
<tr class="separator:aadb5735a48942c795b3be33a17c14eb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98693015cd59e2346ce44ac5af02a4c0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_stream_state.html">StreamState</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_spi_functions_8c.html#a98693015cd59e2346ce44ac5af02a4c0">StreamThreadState</a></td></tr>
<tr class="separator:a98693015cd59e2346ce44ac5af02a4c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains all generic SPI read/write function implementations. </p>
<p>Copyright (c) Analog Devices Inc, 2018 - 2019 All Rights Reserved.</p>
<p>THIS SOFTWARE UTILIZES LIBRARIES DEVELOPED AND MAINTAINED BY CYPRESS INC. THE LICENSE INCLUDED IN THIS REPOSITORY DOES NOT EXTEND TO CYPRESS PROPERTY.</p>
<p>Use of this file is governed by the license agreement included in this repository.</p>
<dl class="section date"><dt>Date</dt><dd>8/1/2019 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>A. Nolan (<a href="#" onclick="location.href='mai'+'lto:'+'ale'+'x.'+'nol'+'an'+'@an'+'al'+'og.'+'co'+'m'; return false;">alex.<span style="display: none;">.nosp@m.</span>nola<span style="display: none;">.nosp@m.</span>n@ana<span style="display: none;">.nosp@m.</span>log.<span style="display: none;">.nosp@m.</span>com</a>) </dd>
<dd>
J. Chong (<a href="#" onclick="location.href='mai'+'lto:'+'jua'+'n.'+'cho'+'ng'+'@an'+'al'+'og.'+'co'+'m'; return false;">juan.<span style="display: none;">.nosp@m.</span>chon<span style="display: none;">.nosp@m.</span>g@ana<span style="display: none;">.nosp@m.</span>log.<span style="display: none;">.nosp@m.</span>com</a>) </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a788c3bd92096e55b7fde4da3a0308f5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a788c3bd92096e55b7fde4da3a0308f5c">&#9670;&nbsp;</a></span>AdiGetSpiSettings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CyU3PReturnStatus_t AdiGetSpiSettings </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function handles vendor commands to get the current SPI configuration from the FX3. </p>
<dl class="section return"><dt>Returns</dt><dd>A status code indicating the success of the function.</dd></dl>
<p>This function allows the FX3 API to verify that the FX3 board has the same SPI settings as the current FX3 connection instance. The current configuration is sent to the PC via EP0. </p>

</div>
</div>
<a id="a57c7fc11222c453959c72eec1aa8afa2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57c7fc11222c453959c72eec1aa8afa2">&#9670;&nbsp;</a></span>AdiReadRegBytes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CyU3PReturnStatus_t AdiReadRegBytes </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function reads a single 16 bit SPI word from a slave device. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">addr</td><td>The address to send to the DUT in the first SPI transaction.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A status code indicating the success of the function.</dd></dl>
<p>This function reads a single word over SPI. Note that reads are not "full duplex" and will require a discrete read to set the address to be read from (two 16 bit transactions per read). </p>

</div>
</div>
<a id="aa083144a6203655613621a89d8e809e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa083144a6203655613621a89d8e809e1">&#9670;&nbsp;</a></span>AdiSpiResetFifo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CyU3PReturnStatus_t AdiSpiResetFifo </td>
          <td>(</td>
          <td class="paramtype">CyBool_t&#160;</td>
          <td class="paramname"><em>isTx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CyBool_t&#160;</td>
          <td class="paramname"><em>isRx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function resets the SPI FIFO and disables the SPI block after completion. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">isTx</td><td>Boolean to indicate if you're clearing the TX FIFO</td></tr>
    <tr><td class="paramname">isRx</td><td>Boolean to indicate if you're clearing the RX FIFO</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The success of the SPI reset FIFO operation.</dd></dl>
<p>It is a copy of the private CyU3PSpiResetFifo() function which bypasses some input sanitization which the Cypress libraries perform. This is required due to our high-speed, register-initiated transfers. </p>

</div>
</div>
<a id="aa715a94cb680f243e03c7d6d2d93503c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa715a94cb680f243e03c7d6d2d93503c">&#9670;&nbsp;</a></span>AdiSpiUpdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CyBool_t AdiSpiUpdate </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function handles a vendor command request to update the SPI/DR Pin configuration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>The wIndex from the control endpoint transaction which indicates which parameter to update</td></tr>
    <tr><td class="paramname">value</td><td>The wValue from the control endpoint transaction which holds the SPI value to set for the selected parameter.</td></tr>
    <tr><td class="paramname">length</td><td>The length of the Data In phase of the control endpoint transaction</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A boolean indicating if the SPI configuration was a success</dd></dl>
<p>This function provides an API for maintaining synchronicity in SPI and data ready triggering settings between the FX3 API and the firmware. Any time a setting is changed on the FX3 API, this function will be invoked to reflect that change. </p>

</div>
</div>
<a id="a5254848805c4b8e74cbc8e94fa78307f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5254848805c4b8e74cbc8e94fa78307f">&#9670;&nbsp;</a></span>AdiTransferBytes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CyU3PReturnStatus_t AdiTransferBytes </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>writeData</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function performs a protocol agnostic SPI bi-directional SPI transfer of (1, 2, 4) bytes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">writeData</td><td>The data to transmit on the MOSI line.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A status code indicating the success of the function.</dd></dl>
<p>This function performs a bi-directional SPI transfer, on up to 4 bytes of data. The transfer length is determined by the current SPI config word length setting. The status and data received on the MISO line are sent to the PC over EP0 following the transfer. </p>

</div>
</div>
<a id="a09c91fa11a171844d59e40a4d0fee7cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09c91fa11a171844d59e40a4d0fee7cf">&#9670;&nbsp;</a></span>AdiWriteRegByte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CyU3PReturnStatus_t AdiWriteRegByte </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function writes a single byte of data over the SPI bus. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">addr</td><td>The DUT address to write data to (7 bits).</td></tr>
    <tr><td class="paramname">data</td><td>The byte of data to write to the address</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A status code indicating the success of the function. </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aadb5735a48942c795b3be33a17c14eb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadb5735a48942c795b3be33a17c14eb4">&#9670;&nbsp;</a></span>FX3State</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_board_state.html">BoardState</a> FX3State</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Struct. which stores all run time configurable FX3 settings </p>

</div>
</div>
<a id="a98693015cd59e2346ce44ac5af02a4c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98693015cd59e2346ce44ac5af02a4c0">&#9670;&nbsp;</a></span>StreamThreadState</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_stream_state.html">StreamState</a> StreamThreadState</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Struct of data used to synchronize the data streaming / app threads </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
